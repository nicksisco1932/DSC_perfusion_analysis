function [IMG,cMap,maxVal2] = overlayImage(IMG1,IMG2,cmap1,cmap2,scalemin,scalemax,varargin)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%if ~exist('cmap1','var')    cmap1 = 'gray';    warning('assuming TR is 1 second');end% Get maximum value of IMG2maxVal2 = max(IMG2(:));% % fact = 100/maxVal2;if scalemax == ''    scalemax = maxVal2;endfactmax = (scalemax)/maxVal2;factmin = scalemin/maxVal2;if strcmp(cmap2, 'fDM')% %     IMG2(IMG2(:)<scalemin) = scalemin*0.95;endIMG2(IMG2(:)<scalemin) = 0;IMG2(isnan(IMG2)) = 0;% Normalize imagesIMG1 = IMG1./max(IMG1(:))*(factmax-factmin);IMG2 = IMG2./max(IMG2(:)) - factmin;% if ~strcmp(cmap2, 'fDM')IMG2(IMG2 == -factmin) = 0;% end% CombineIMG = -IMG1;IMG(find(IMG2)) = IMG2(find(IMG2));% Create combined colormaph1 = colormap(cmap1);if strcmp(cmap2, 'posmap')        cmap2 = cmap(size(h1,1),[0,1,1],[0,0,1],[0,0,0],[1,0,0],[1,1,0]);% %     cmap2 = cmap(size(h1,1),[0,1,1],[0,0,1],[0,0,0],[0.5,0,0],[1,0,0],[1,0.75,0],[1,1,0]);% %         cmap2 = cmap(size(h1,1),[0,1,1],[0,0.75,1],[0,0,1],[0 0 0.5],[0,0,0],[1,0,0],[1,1,0]);endif strcmp(cmap2, 'deact')    cmap2=cmap(size(h1,1),[0,1,1],[1,0,1],[0,0,0]);    %%cat(1,flipud([[63:-1:0]'./63,[0:1:63]'./63,ones(64,1)]),flipud([[0:1:63]'./63,zeros(64,1),[0:1:63]'./63]));endif strcmp(cmap2, 'fDM')    cmap2 = repmat([0 0.5 0],[size(h1,1) 1]);    cmap2(end-29:end,:) = repmat([1 0 0],[30 1]);    cmap2(1:30,:) = repmat([0 0 1],[30 1]);endif strcmp(cmap2, 'Miller')    load('Miller_CBFcolormap2.mat');    cmap2 = Miller_CBFcolormap;    h2 = colormap(cmap2);    cmap1=cmap(size(h2,1),[0,0,0],[1,1,1]);    h1 = colormap(cmap1);endif strcmp(cmap2, 'temp')    cmap2 = cmap(size(h1,1),[0 0 0],[0 0 0.8],[0.8 0 0], [0 0.8 0], [0.7 0.1 0.5], [0.8 0.8 0]);endh2 = colormap(cmap2); closecMap = [h1(end:-1:1,:) ; [0 0 0] ; h2];        figure;imagesc(IMG,[-factmax+factmin factmax-factmin]), colormap(cMap), %axis image off    colorbar;    %=======read in optional inputs=========for ii=1:length(varargin)    if isequal(varargin{ii},'caxpts')        caxpts = varargin{ii+1};        yTick = (factmax-factmin)*(0:1:caxpts)/caxpts;    endend%=======================================if ~exist('caxpts','var');% %     yTick = (factmax-factmin)*[0 0.2 .4 .6 .8 1];% %         yTick = (factmax-factmin)*[0 1/3 2/3 1];% %     yTick = (factmax-factmin)*[0.115 0.308 0.5 0.693 0.885];% %     yTick = (factmax-factmin)*[0 0.25 0.5 0.75 1];% %     yTick = (factmax-factmin)*[0 1 2 3 4 5 6]/6;% % yTick = (factmax-factmin)*[0 1 2 3 4 5 6 7]/7;yTick = (factmax-factmin)*[1:14]/14.5;end%     if maxVal2 > 1%         maxVal2=1;%     end    yTickLabel = {round(maxVal2*(yTick+factmin)*1e2)./1e2};% %     yTickLabel = {'20%' 40 60 80};if ~isstr(cmap2)%         yTickLabel = {'hippocampus' 'accumbens' 'ventral DC' 'cerebral cortex' 'putamen' 'inf lateral ventricle' 'lateral ventricle' 'corpus callosum' 'pallidum' 'amygdala' 'choroid plexus' 'thalamus' 'caudate' 'cerebral WM'};        t = colorbar('YLim',[factmin-factmin factmax-factmin],'YTick',yTick,'YTickLabel',yTickLabel);else    t = colorbar('YLim',[factmin-factmin factmax-factmin],'YTick',yTick,'YTickLabel',yTickLabel);end        % %     colorbar('YLim',[factmin-factmin factmax-factmin],'YTick',yTick,'YTickLabel','')% %         set(get(t,'xlabel'),'String', '%ID/(g*min)','FontName','Helvetica','FontSize',24,'FontWeight','bold');end